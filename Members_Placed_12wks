## GROUP HEALTH: Members placed in New Groups (last 12 wks)

## Finds all members placed in new groups in the last 12 weeks


WITH PlacedMembers AS (

select 
    g.id as groupId,
    gm.id as group_member_id,
    g.name as groupName,
    CONCAT(u.firstName, " ",u.lastName) as memberName,
    g.startDate as startDate,
    gm.startDate as memberStartDate,
    #COUNT(DISTINCT gm.id) as totalPlaced,
    DATE_SUB(DATE(gm.startDate), INTERVAL DAYOFWEEK(gm.startDate)-1 DAY) as weekCohort

from grps g 
join grme gm on gm.groupId = g.id
left join usss u on u.id = gm.userId
where

    gm.fac IS NOT TRUE  


-- we want those placed prior to group start (new groups)
having gm.startDate <= g.startDate+INTERVAL 1 HOUR -- interval to make up for UTC/PST time differences if member was added the day of session (or readded)

order by
    g.startDate desc 
)

select 
    pm.weekCohort as "Week",
    COUNT(DISTINCT pm.group_member_id) as "Total Placed in NG"

from PlacedMembers pm 

group by 
    pm.weekCohort 

order by 
    pm.weekCohort desc 

LIMIT 12
